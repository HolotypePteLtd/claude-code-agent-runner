x-runner-common: &runner-common
  platform: linux/amd64
  build:
    context: .
    dockerfile: Dockerfile
  env_file: .env
  restart: unless-stopped

services:
  runner-1:
    <<: *runner-common
    environment:
      - GITHUB_RUNNER_NAME=${GITHUB_RUNNER_NAME:-claude-runner}-1
    volumes:
      - runner-data-1:/actions-runner
      - claude-config:/home/runner/.claude
      - flutter-cache:/opt/flutter/.pub-cache
      - npm-cache:/home/runner/.npm

  runner-2:
    <<: *runner-common
    environment:
      - GITHUB_RUNNER_NAME=${GITHUB_RUNNER_NAME:-claude-runner}-2
    volumes:
      - runner-data-2:/actions-runner
      - claude-config:/home/runner/.claude
      - flutter-cache:/opt/flutter/.pub-cache
      - npm-cache:/home/runner/.npm

  runner-3:
    <<: *runner-common
    environment:
      - GITHUB_RUNNER_NAME=${GITHUB_RUNNER_NAME:-claude-runner}-3
    volumes:
      - runner-data-3:/actions-runner
      - claude-config:/home/runner/.claude
      - flutter-cache:/opt/flutter/.pub-cache
      - npm-cache:/home/runner/.npm

volumes:
  runner-data-1:
  runner-data-2:
  runner-data-3:
  claude-config:
  flutter-cache:
  npm-cache:
